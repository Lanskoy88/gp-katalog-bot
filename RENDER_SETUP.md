# Настройка развертывания на Render

## Шаг 1: Подключение к Render

1. Перейдите на [render.com](https://render.com)
2. Войдите в свой аккаунт или создайте новый
3. Нажмите "New +" и выберите "Web Service"

## Шаг 2: Подключение репозитория

1. Подключите ваш GitHub репозиторий: `https://github.com/Lanskoy88/gp-katalog-bot`
2. Выберите ветку `main`

## Шаг 3: Настройка сервиса

### Основные настройки:
- **Name**: `gp-katalog-bot`
- **Environment**: `Node`
- **Region**: Выберите ближайший к вам регион
- **Branch**: `main`
- **Build Command**: `npm run install-all`
- **Start Command**: `npm start`

### Переменные окружения (Environment Variables):

Добавьте следующие переменные в раздел "Environment Variables":

```
NODE_ENV=production
TELEGRAM_BOT_TOKEN=7207292392:AAEfMX6zpgf-pXUfyeLYe_xhXw439CL6POs
MOYSKLAD_API_TOKEN=876311c15447994f9f5d11e90112c482026fd6bb
MOYSKLAD_ACCOUNT_ID=7d408f60-5980-11e9-9109-f8fc0000577b
BASE_URL=https://gp-katalog-bot.onrender.com
ADMIN_IDS=123456789,987654321
ALLOWED_ORIGINS=https://web.telegram.org
```

## Шаг 4: Настройка Web App URL в Telegram

После развертывания обновите URL мини-приложения в BotFather:

1. Отправьте `/setmenubutton` в BotFather
2. Выберите вашего бота
3. Установите URL: `https://gp-katalog-bot.onrender.com/catalog`

## Шаг 5: Проверка развертывания

1. Дождитесь завершения сборки (обычно 5-10 минут)
2. Проверьте логи на наличие ошибок
3. Откройте URL: `https://gp-katalog-bot.onrender.com/health`
4. Должен вернуться JSON с статусом "OK"

## Шаг 6: Тестирование бота

1. Откройте Telegram и найдите вашего бота
2. Отправьте команду `/start`
3. Нажмите кнопку "Открыть каталог"
4. Должно открыться мини-приложение с каталогом товаров

## Возможные проблемы и решения

### Проблема: Ошибка сборки
**Решение**: Проверьте логи сборки, убедитесь что все зависимости установлены

### Проблема: Бот не отвечает
**Решение**: 
1. Проверьте переменную `TELEGRAM_BOT_TOKEN`
2. Убедитесь что бот не заблокирован
3. Проверьте логи на наличие ошибок подключения

### Проблема: Web App не открывается
**Решение**:
1. Проверьте переменную `BASE_URL`
2. Убедитесь что URL правильно настроен в BotFather
3. Проверьте CORS настройки

### Проблема: MoySklad API не работает
**Решение**:
1. Проверьте переменные `MOYSKLAD_API_TOKEN` и `MOYSKLAD_ACCOUNT_ID`
2. Убедитесь что токен активен и имеет необходимые права

## Мониторинг

- **Логи**: Доступны в разделе "Logs" на Render
- **Метрики**: Доступны в разделе "Metrics"
- **Health Check**: `https://gp-katalog-bot.onrender.com/health`

## Автоматическое развертывание

Render автоматически развертывает приложение при каждом пуше в ветку `main`.

## Стоимость

- **Free план**: До 750 часов в месяц
- **Paid план**: $7/месяц за дополнительные часы

## Поддержка

При возникновении проблем:
1. Проверьте логи на Render
2. Проверьте статус сервиса
3. Убедитесь что все переменные окружения настроены правильно 